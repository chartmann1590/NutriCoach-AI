{% extends "base.html" %}

{% block title %}Profile Settings - NutriCoach{% endblock %}
{% block page_title %}Profile Settings{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <div class="space-y-6">
        <!-- Basic Information -->
        <div class="bg-white dark:bg-gray-800 shadow rounded-lg">
            <div class="px-4 py-5 sm:p-6">
                <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-gray-100 mb-4">
                    Basic Information
                </h3>
                <form method="POST" action="/settings/profile" class="space-y-4">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                    <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                        <div>
                            <label for="name" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                Full Name
                            </label>
                            <input type="text" id="name" name="name" 
                                   value="{{ current_user.name or '' }}"
                                   class="mt-1 shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-gray-100">
                        </div>
                        
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                Email Address
                            </label>
                            <input type="email" id="email" name="email" 
                                   value="{{ current_user.email }}" readonly
                                   class="mt-1 shadow-sm block w-full sm:text-sm border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-800 text-gray-500 dark:text-gray-400">
                            <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Email cannot be changed</p>
                        </div>
                    </div>
                    
                    {% if profile %}
                    <div class="grid grid-cols-1 gap-6 sm:grid-cols-4">
                        <div>
                            <label for="age" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                Age
                            </label>
                            <input type="number" id="age" name="age" min="13" max="120"
                                   value="{{ profile.age }}"
                                   class="mt-1 shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-gray-100">
                        </div>
                        
                        <div>
                            <label for="sex" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                Sex
                            </label>
                            <select id="sex" name="sex"
                                    class="mt-1 shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-gray-100">
                                <option value="male" {{ 'selected' if profile.sex == 'male' }}>Male</option>
                                <option value="female" {{ 'selected' if profile.sex == 'female' }}>Female</option>
                                <option value="other" {{ 'selected' if profile.sex == 'other' }}>Other</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="height_cm" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                Height (cm)
                            </label>
                            <input type="number" id="height_cm" name="height_cm" min="100" max="250"
                                   value="{{ profile.height_cm }}"
                                   class="mt-1 shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-gray-100">
                        </div>
                        
                        <div>
                            <label for="weight_kg" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                Weight (kg)
                            </label>
                            <input type="number" id="weight_kg" name="weight_kg" min="30" max="300" step="0.1"
                                   value="{{ profile.weight_kg }}"
                                   class="mt-1 shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-gray-100">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                        <div>
                            <label for="activity_level" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                Activity Level
                            </label>
                            <select id="activity_level" name="activity_level"
                                    class="mt-1 shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-gray-100">
                                <option value="sedentary" {{ 'selected' if profile.activity_level == 'sedentary' }}>Sedentary (little/no exercise)</option>
                                <option value="light" {{ 'selected' if profile.activity_level == 'light' }}>Light (light exercise/sports 1-3 days/week)</option>
                                <option value="moderate" {{ 'selected' if profile.activity_level == 'moderate' }}>Moderate (moderate exercise/sports 3-5 days/week)</option>
                                <option value="active" {{ 'selected' if profile.activity_level == 'active' }}>Active (hard exercise/sports 6-7 days/week)</option>
                                <option value="very_active" {{ 'selected' if profile.activity_level == 'very_active' }}>Very Active (very hard exercise/sports & physical job)</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="goal_type" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                Goal
                            </label>
                            <select id="goal_type" name="goal_type"
                                    class="mt-1 shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-gray-100">
                                <option value="lose" {{ 'selected' if profile.goal_type == 'lose' }}>Lose Weight</option>
                                <option value="maintain" {{ 'selected' if profile.goal_type == 'maintain' }}>Maintain Weight</option>
                                <option value="gain" {{ 'selected' if profile.goal_type == 'gain' }}>Gain Weight</option>
                            </select>
                        </div>
                    </div>
                    {% endif %}
                    
                    <div class="flex justify-end">
                        <button type="submit" 
                                class="ml-3 inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Dietary Preferences -->
        {% if profile %}
        <div class="bg-white dark:bg-gray-800 shadow rounded-lg">
            <div class="px-4 py-5 sm:p-6">
                <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-gray-100 mb-4">
                    Dietary Preferences
                </h3>
                <form method="POST" action="/settings/profile" class="space-y-4">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">
                            Select your dietary restrictions or preferences:
                        </label>
                        <div class="grid grid-cols-2 gap-3 sm:grid-cols-3">
                            {% set preferences = profile.get_preferences() if profile else [] %}
                            {% for pref in ['vegetarian', 'vegan', 'gluten_free', 'dairy_free', 'keto', 'paleo', 'low_carb', 'low_fat', 'halal', 'kosher'] %}
                            <div class="flex items-center">
                                <input type="checkbox" id="{{ pref }}" name="preferences" value="{{ pref }}"
                                       {{ 'checked' if pref in preferences }}
                                       class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                                <label for="{{ pref }}" class="ml-2 text-sm text-gray-700 dark:text-gray-300">
                                    {{ pref.replace('_', ' ').title() }}
                                </label>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <div>
                        <label for="allergies_text" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                            Food Allergies (comma-separated)
                        </label>
                        <textarea id="allergies_text" name="allergies_text" rows="2"
                                  placeholder="e.g., peanuts, shellfish, eggs"
                                  class="mt-1 shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-gray-100">{% if profile %}{{ ', '.join(profile.get_allergies()) }}{% endif %}</textarea>
                    </div>
                    
                    <div class="flex justify-end">
                        <button type="submit" 
                                class="ml-3 inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            Save Preferences
                        </button>
                    </div>
                </form>
            </div>
        </div>
        {% endif %}

        <!-- Current Stats -->
        {% if profile %}
        <div class="bg-white dark:bg-gray-800 shadow rounded-lg">
            <div class="px-4 py-5 sm:p-6">
                <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-gray-100 mb-4">
                    Current Statistics
                </h3>
                <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                    <div class="text-center">
                        <div class="text-2xl font-bold text-indigo-600 dark:text-indigo-400">
                            {{ "%.1f"|format(profile.weight_kg or 0) }}kg
                        </div>
                        <div class="text-sm text-gray-500 dark:text-gray-400">Current Weight</div>
                    </div>
                    
                    <div class="text-center">
                        <div class="text-2xl font-bold text-green-600 dark:text-green-400">
                            {{ profile.height_cm or 0 }}cm
                        </div>
                        <div class="text-sm text-gray-500 dark:text-gray-400">Height</div>
                    </div>
                </div>
                
                <div class="mt-4 text-center">
                    <a href="/settings/recalculate-goals" 
                       class="inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 shadow-sm text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
                        <i class="fas fa-calculator mr-2"></i>
                        Recalculate Goals
                    </a>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}